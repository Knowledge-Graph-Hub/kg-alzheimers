pipeline {
   agent any
    stages {
        stage('setup') {
            steps {
                sh '''
                    docker rm -f neo || True
                    docker run --name neo -p7474:7474 -p7687:7687 -d --env NEO4J_AUTH=neo4j/admin neo4j:3.4.15
                    pip --version
                    python3 --version
                    pip install poetry
                    alias poetry="~/.local/bin/poetry"
                    poetry install
                    gsutil cp gs://monarch-ingest/latest/monarch-kg.tar.gz .
                    poetry run which kgx
                    poetry run kgx transform --transform-config neo4j-transform.yaml
                    docker cp neo:/data .
                    tar czf neo4j.tar.gz data
                '''
            }
        }
    }
}