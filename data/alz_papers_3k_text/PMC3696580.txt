# Title
Fast and accurate genotype imputation in genome-wide association studies through pre-phasing

# Abstract
Sequencing efforts, including the 1000 Genomes Project and disease-specific efforts, are producing large collections of haplotypes that can be used for genotype imputation in genome-wide association studies (GWAS). Imputing from these reference panels can help identify new risk alleles, but the use of large panels with existing methods imposes a high computational burden. To keep imputation broadly accessible, we introduce a strategy called “pre-phasing” that maintains the accuracy of leading methods while cutting computational costs by orders of magnitude. In brief, we first statistically estimate the haplotypes for each GWAS individual (“pre-phasing”) and then impute missing genotypes into these estimated haplotypes. This reduces the computational cost because: (i) the GWAS samples must be phased only once, whereas standard methods would implicitly re-phase with each reference panel update; (ii) it is much faster to match a phased GWAS haplotype to one reference haplotype than to match unphased GWAS genotypes to a pair of reference haplotypes. This strategy will be particularly valuable for repeated imputation as reference panels evolve.

## RESULTS
To illustrate the computational advantages of pre-phasing, we analyzed a GWAS dataset of 2,490 individuals from the 1958 British Birth Cohort of the Wellcome Trust Case Control Consortium 2 (WTCCC2) 10 . We imputed this dataset from a series of reference panels using related imputation methods that account for phase uncertainty in different ways ( Table 1 ). IMPUTE version 1 (“IMPUTE1 11 ”) uses an analytical integration strategy. This was relatively efficient with a reference panel of 60 individuals (41 minutes per genome with 1000 Genomes Pilot data), but the computational burden grew quickly as haplotypes were added to the reference set. By contrast, IMPUTE version 2 (“IMPUTE2 6 ”) uses a haplotype sampling strategy. This approach scaled more favorably with larger reference panels, but it still required 512 minutes per genome to impute from the latest 1000 Genomes panel. By comparison, an updated version of IMPUTE2 that uses our proposed approach required a one-time pre-phasing investment of 25 minutes per genome, then just 24 minutes to impute each sample from the largest reference panel. We observed similar trends with MaCH 12 (which typically uses a similar approach to IMPUTE1) and minimac (which performs imputation with pre-phased haplotypes in the MaCH framework), as shown in Supplementary Table 1 .

These results demonstrate that pre-phasing can greatly speed up the imputation process, but the accuracy of imputation with this shortcut may depend on how well the GWAS haplotypes were estimated. The accuracy of computationally estimated haplotypes depends on a number of factors including marker density, relatedness of sampled individuals, sample size, and demography 12 , 13 . In founder populations 14 , long-range haplotypes can be estimated very accurately even with modest sample sizes 9 . For example, by comparing the results of population- and trio-based phasing in Finnish samples from the FUSION study of type 2 diabetes 2 , 15 , we estimate that population phasing produces <1 switch error 16 per 5.5 megabases (Mb). These results were aided by the relatively large number of genotyped individuals (>2,000) and by the fact that Finland is a founder population in which long haplotypes are shared between apparently unrelated individuals. In more diverse populations, haplotype estimation may often be less accurate. For example, average distances between switches in European GWAS datasets are typically in the range of 0.6 to 1.4 Mb 17 .

Here, we evaluate whether pre-phased haplotypes can be used to accurately impute missing genotypes in three GWAS datasets sampled from diverse populations: the WTCCC2 data described above, a European-American case-control dataset from a psoriasis study by the Genetic Association Information Network (GAIN) 18 , and a set of African Americans from the Women’s Health Initiative (WHI) 19 . In each dataset we masked and imputed a subset of the genotyped SNPs, as detailed in Table 2 . We measured imputation accuracy at these SNPs as the average squared correlation (mean R 2 ) between masked array genotypes and imputed allele dosages (posterior mean genotypes).

We used the GAIN dataset to compare a well-benchmarked imputation method (MaCH) against a related method that uses pre-phasing (minimac). Encouragingly, both methods produced similar accuracy when applied to a common reference panel of 60 CEU individuals ( Table 2 ). In fact, our pre-phasing strategy generated slightly better results despite ignoring the uncertainty in the estimated GWAS haplotypes, possibly because pre-phasing captures joint LD information that is not used by the analytical phasing/imputation framework of methods like MaCH and IMPUTE1.

We then used the WTCCC2 data to compare pre-phasing against a haplotype sampling approach, both of which were implemented in IMPUTE2 6 . Our results again show that pre-phasing can provide comparable accuracy to the existing imputation method, although in this case the pre-phasing results were slightly less accurate ( Table 2 ). Both pre-phasing and haplotype sampling capture LD information in the GWAS data, but the sampling approach also accounts for some of the uncertainty in phasing the GWAS genotypes, which could explain why it is more accurate here.

Finally, since it is well established that phasing and imputation can be more challenging in individuals with recent African ancestry because of their reduced LD and higher genetic diversity, we evaluated our pre-phasing approach in the WHI GWAS of African Americans. In this comparison pre-phasing was less accurate than MaCH’s analytical approach by the largest (but still small) margin in Table 2 , which we interpret as evidence that accounting for phase uncertainty is more important when the haplotypes are harder to estimate.

The advantages of pre-phasing become particularly clear when considering successive reference panels that have been updated over time. Following a relatively modest pre-phasing investment, each new reference panel can be imputed at a low computational cost while improving the accuracy and completeness of the imputed genotypes. This point is illustrated by Table 2 , which shows that adding haplotypes to the 1000 Genomes resource increased accuracy for all SNPs, especially those with minor allele frequency (MAF) of 1–3%: from a mean R 2 of 0.65 to 0.75 to 0.82 in the WTCCC2; from a mean R 2 of 0.69 to 0.73 to 0.83 in GAIN; and from a mean R 2 of 0.49 to 0.55 to 0.61 in the WHI. Beyond the accuracy increase at known variants, each new panel also introduces many novel variants that could lead to additional association signals and biological insights.

One caveat to the comparisons above is that SNPs on GWAS arrays tend to be more common (e.g., see Supplementary Fig. 1 ) and easier to impute than unascertained SNPs 2 . We addressed this issue by performing a cross-validation in the EUR panel of 1000 Genomes Phase I, which includes a more complete set of SNPs discovered by low-pass whole-genome and high-pass exome sequencing in >1,000 individuals. For each of the 381 EUR individuals in turn, we masked genotypes on chromosome 10 at all sites except those included on Affymetrix 500k SNP arrays, then imputed the missing sites using the Affymetrix 500k scaffold and the remaining 760 EUR haplotypes. To mimic pre-phasing in a GWAS, we reduced the EUR dataset to sites present on the array scaffold, re-phased the genotypes, and then used these estimated haplotypes when imputing masked genotypes for a given individual.

The bottom rows in Table 2 show the results of running this experiment. To provide a point of comparison with the GWAS results in Table 2 , we initially imputed only the SNPs that were used in the WTCCC2 analysis (“WTCCC2 SNPs”). The imputation accuracy at these SNPs was slightly lower in the EUR cross-validation than in the WTCCC2 analysis; e.g., pre-phasing in EUR produced mean R 2 values of 0.81, 0.85, and 0.91 for SNPs in ascending MAF bins, as compared to 0.82, 0.86, and 0.91 for the WTCCC2 experiment with the same scaffold SNPs, reference panel, and phasing approach ( Table 2 ). These differences in pre-phasing accuracy may reflect the relative amount of phase information in a sample of 381 individuals (1000 Genomes EUR) and a sample of nearly 2,500 individuals (WTCCC2). Nonetheless, the overall similarity in results suggests that our EUR cross-validation provides a good approximation to a European GWAS.

We next extended the experiment by imputing the full set of SNPs in the EUR sequence data (“sequence SNPs”). As expected, the sequence SNPs were imputed less accurately than the WTCCC2 SNPs within each frequency bin. For example, haplotype sampling produced mean R 2 values of 0.82, 0.86, and 0.92 (for MAF 1–3%, 3–5%, and >5%, respectively) in the array SNP analysis described above, but the accuracy dropped to 0.66, 0.79, and 0.91 when evaluating all sequence SNPs in the same frequency ranges ( Table 2 ). Despite the added difficulty of imputing low-frequency and unascertained variants, pre-phasing was still nearly as effective as haplotype sampling at these SNPs (mean R 2 of 0.64 vs. 0.66 for MAF 1–3%; Table 2 ). This analysis also allows us to measure accuracy at SNPs with MAF < 1%, where we observed mean R 2 values of 0.42 and 0.44 for pre-phasing and haplotype sampling, respectively. Hence, while all methods have lower imputation accuracy at unascertained and low-frequency SNPs, pre-phasing still achieves competitive accuracy at such variants.

The examples in Table 2 show that imputation accuracy may sometimes decrease when using the most likely haplotype pair for each GWAS individual rather than integrating over the phase uncertainty. We also note that, over the span of entire chromosomes and in the datasets examined here, haplotype estimates will almost never match the true underlying haplotypes. These considerations led us to assess whether we could improve accuracy for a reasonable increment in computing time by saving multiple sampled haplotype configurations at the pre-phasing stage and then imputing into each of these (see Supplementary Notes for details). Supplementary Fig. 2 and Supplementary Fig. 3 show that imputing into 4–10 sampled haplotypes per individual provide a small increase in accuracy while increasing computational costs by 4–10x. At the same time, Supplementary Fig. 2 shows that using a much larger number of sampled haplotypes (up to 500 per individual, for a 500x increase in computing time) provides only a modest additional increase in accuracy, which confirms that a single pre-phased configuration provides nearly as much accuracy as much more compute intensive methods for capturing haplotype uncertainty. These results suggest that pre-phasing is a good general strategy for genome-wide imputation, while slower but more accurate approaches may be useful for follow-up analyses near putative disease loci.

## DISCUSSION
We have described a practical strategy for imputing genotypes from the large reference panels that are now emerging from sequencing efforts like the 1000 Genomes Project. These panels are regularly updated, both to incorporate newly sequenced individuals and to take advantage of improved methods for analyzing next-generation sequence data that can handle increasingly diverse variant types, including insertion/deletion polymorphisms and copy number variants. New reference datasets may provide significant benefits for disease studies, but imputing them into large-scale GWAS currently requires substantial computational resources. The pre-phasing strategy introduced here will allow investigators to routinely impute from these emerging reference panels at a reasonable computational cost and thereby enhance studies of complex disease genetics.

Overall, our results show that pre-phasing provides comparable accuracy to state-of-the-art imputation methods. While Tables 1 and 2 focus on selected combinations of data and methods, we also find that minimac and IMPUTE2 produce very similar trends in accuracy and running time when applied to the same dataset (for details, see Supplementary Fig. 4 and compare Table 1 and Supplementary Table 1 ).

It is somewhat surprising that pre-phasing remains competitive with other methods when imputing rare variants (MAF < 1%; Table 2 ). Such variants should require longer flanking haplotypes for successful imputation, and a single pre-phasing solution may include errors that break up long-range haplotypes. One possible explanation is that existing methods also struggle to infer very long haplotypes, so that pre-phasing still looks accurate by comparison. Conversely, it is important to realize that imputation accuracy is affected by phasing accuracy in the reference panel and by the GWAS SNPs used to drive imputation 4 , 5 . Imperfections in the reference haplotypes would limit imputation accuracy even with perfectly phased GWAS haplotypes, and it may be difficult to impute rare variants with any method when using sparse GWAS scaffolds. These factors may outweigh the differences between methods that use pre-phasing and those that integrate over phase uncertainty.

We consider extensions of the pre-phasing approach in the Supplementary Material , including an exploration of multiple imputation approaches and an example of how imputation accuracy can be improved by pre-phasing with other haplotyping engines like SHAPEIT 17 . We also note that when genotypes from family members are available, it may be particularly attractive to use our imputation software with haplotypes informed by transmission patterns in pedigrees, where the best phasing tool may depend on family structure.

Our results show that pre-phasing is a highly generalizable strategy that can be adapted to most imputation engines, and we expect that it will be combined with future methodological developments to make imputation even faster and more flexible. Software implementing our approach, using either the IMPUTE2 or MaCH/minimac framework, is available from the authors’ websites.

## Online Methods
The Finland-United States Investigation of Non-Insulin-Dependent Diabetes Mellitus Genetics (FUSION) Study consists of 1,161 Finnish individuals with type 2 diabetes (T2D) and 1,174 normal glucose tolerant Finnish controls. Samples were genotyped with the Illumina Human-Hap300 BeadChip (v1.1). In sum, 306,222 autosomal SNPs passed quality control (HWE P ≥ 10 −6 in the total sample, call frequency ≥ 0.90 and MAF > 0.01) 15 . In addition, 120 trios were genotyped with the same chip and haplotypes were estimated based on the most likely pattern of gene flow using Merlin 20 and compared with haplotypes estimated statistically using population information and the software program MaCH 12 .

The Genetic Association Information Network (GAIN) 21 supported a series of Genome-Wide Association Studies (GWAS) designed to identify specific points of DNA variation associated with the occurrence of a particular common disease. Data used for this study included 1,359 psoriasis cases and 1,400 controls genotyped at Perlegen Sciences using a custom genotyping array. In total, 438,670 autosomal SNPs passed the quality control filters (HWE P ≥ 10 −6 in the total sample, call frequency ≥ 0.95 and MAF > 0.01) 21 . In this study, 88 individuals were also genotyped using Affymetrix 6.0 arrays and these genotypes were used to evaluate imputation accuracy by examining the correlation between imputed dosages and array genotypes (for markers that were present on the Affymetrix 6.0 arrays but not on the Perlegen custom array).

We used genotype data from the Wellcome Trust Case Control Consortium 2 (WTCCC2) 10 on members of the 1958 British Birth Cohort, which is comprised of controls sampled from the United Kingdom. These individuals were genotyped on Affymetrix 6.0 and Illumina 1.2 M SNP arrays. The WTCCC2 merged genotypes across platforms and applied standard QC filters, which resulted in 2,490 individuals and 71,190 SNPs on chromosome 10. For our imputation experiments we masked the SNPs not found on the Affymetrix 500k array, imputed the masked SNPs, and compared the imputed dosages against the original array genotypes.

We obtained genotype data for the Women’s Health Initiative (WHI) 19 study from dbGaP ( http://www.ncbi.nlm.nih.gov/gap ). The dataset included 8,421 African Americans genotyped on Affymetrix 6.0. We removed SNPs with genotype call rates < 90%, HWE P < 10 −6 , or MAF < 1%, resulting in 829,370 SNPs passing quality control criteria. For our imputation experiments we masked every 10 th SNP and repeated in sliding windows, such that each analysis was informed by ~90% of the array SNPs and every array SNP was imputed exactly once.

Haplotyping approaches such as those implemented in MaCH and IMPUTE2 proceed through a series of iterative steps. In each step, a new pair of haplotypes is sampled for each individual as an imperfect mosaic 22 of the estimated haplotypes (“templates”) for other individuals in the dataset. After a number of iterations, “best-guess” haplotypes are constructed for each individual by combining information across the sampled haplotype configurations; both MaCH and IMPUTE2 perform this step by minimizing the expected switch error rate 23 . The computational cost of phasing with these methods depends on the number of iterations performed and the number of template haplotypes that are used in each update. For the experiments described here, we used 20 iterations and 200 – 400 templates for MaCH and 30 iterations (first 10 discarded as burn-in) and 80 templates for IMPUTE2. These methods differ in various details, such as how they fit the parameters of their models and how they choose templates for each haplotype sampling step; further information is provided in the original papers 6 , 12 .

When GWAS genotypes have been phased prior to imputation, each haplotype can be imputed separately if we assume that the GWAS haplotypes are conditionally independent, given a reference panel. The reference panel provides template haplotypes for the imputation model, and marginal probabilities for the untyped alleles in each GWAS haplotype are estimated via standard hidden Markov model (HMM) calculations (the “forward-backward” algorithm 24 ). The parameters of the HMM are estimated in different ways by minimac and IMPUTE2; see elsewhere for details 6 , 12 . Allelic probabilities are converted to genotypic probabilities for each individual by assuming Hardy-Weinberg equilibrium; these genotypic probabilities can be directly compared with those produced by other imputation approaches.

Many existing imputation methods (e.g., MaCH and IMPUTE1) use analytical integration to account for the unknown phase of GWAS genotypes. The computational cost of this approach is proportional to the number of GWAS individuals ( N ), the number of genotyped markers in the reference panel ( M REF ), and the square of the number of reference haplotypes ( H ), or O( N * M REF * H 2 ). Some methods, such as fastPHASE 23 and Beagle 25 , reduce H by grouping similar haplotypes into clusters. The quadratic term affects all markers, whether they are typed in a GWAS or just in the reference panel. Consequently, the computational cost grows quickly with reference panel size, and it can be time-consuming to run these methods on modern reference datasets.

IMPUTE2 aims to reduce the computing burden through a Monte Carlo algorithm that separates the phasing and imputation tasks. This approach alternately samples phase configurations for genotyped markers and imputes allele probabilities for markers not typed in the GWAS. The cost of the phasing component is proportional to the number of GWAS individuals ( N ), the number of genotyped markers in the GWAS data ( M GWAS ), the number of iterations ( I ), and the square of the number of templates used in each phasing update ( K 2 ), or O( N * M GWAS * I * K 2 ). The cost of the imputation component is proportional to the number of GWAS haplotypes (2 N ), the number of markers in the reference panel ( M REF ), the number of iterations ( I ), and the number of haplotypes in the reference panel ( H ), or O( N * M REF * I * H ). Partitioning the analysis in this way allows better scaling with reference panel size, but it requires I repetitions of the imputation step (one for each sampled phase configuration).

Like the IMPUTE2 Monte Carlo algorithm, pre-phasing separates the phasing and imputation steps when imputing a GWAS dataset. The computational cost of pre-phasing in our framework is O( N * M GWAS * I * K 2 ). This is the same as the phasing cost for Monte Carlo integration, although in this context the phasing must be performed just once per GWAS dataset. Given a set of pre-phased GWAS haplotypes, the cost of imputation is then O( N * M REF * H ); the efficiency of this step makes imputation from pre-phased haplotypes very fast. The cost of each step in our current computing system, in CPU hours, is approximately N * M GWAS * I * K 2 * 10 −11 for phasing and N * M REF * H * 10 −11 for imputation.