# Title
GREAT improves functional interpretation ofcis-regulatory regions

# Abstract
We developed the Genomic Regions Enrichment of Annotations Tool (GREAT) to analyze the functional significance of cis -regulatory regions identified by localized measurements of DNA binding events across an entire genome. Whereas previous methods took into account only binding proximal to genes, GREAT is able to properly incorporate distal binding sites and control for false positives using a binomial test over the input genomic regions. GREAT incorporates annotations from 20 ontologies and is available as a web application. Applying GREAT to data sets from chromatin immunoprecipitation coupled with massively parallel sequencing (ChIP-seq) of multiple transcription-associated factors, including SRF, NRSF, GABP, Stat3 and p300 in different developmental contexts, we recover many functions of these factors that are missed by existing gene-based tools, and we generate testable hypotheses. The utility of GREAT is not limited to ChIP-seq, as it could also be applied to open chromatin, localized epigenomic markers and similar functional data sets, as well as comparative genomics sets.

## RESULTS
Here we describe GREAT, which analyzes the functional significance of sets of cis -regulatory regions by explicitly modeling the vertebrate genome regulatory landscape and using many rich information sources.

GREAT associates genomic regions with genes by defining a ‘regulatory domain’ for each gene in the genome. Each genomic region is associated with all genes in whose regulatory domains it lies ( Fig. 1b ). High-throughput chromosomal conformation capture (3C) approaches such as 5C (ref. 17 ), Hi-C (ref. 18 ) or enhanced ChIP-4C (ref. 19 ) are providing first glimpses of actual gene regulatory domains. Because we still lack precise empirical maps, however, GREAT assigns each gene a regulatory domain consisting of a basal domain that extends 5 kb upstream and 1 kb downstream from its transcription start site (denoted below as 5+1 kb), and an extension up to the basal regulatory domain of the nearest upstream and downstream genes within 1 Mb (GREAT allows the user to modify the rule and distances). GREAT further refines the regulatory domains of a handful of genes, including several global control regions 20 , by using their experimentally determined regulatory domains. Our tool can also incorporate additional locus-based and genome-wide data as they become available ( Supplementary Fig. 2 and Online Methods).

Given a set of input genomic regions and an ontology of gene annotations, GREAT computes ontology term enrichments using a binomial test that explicitly accounts for variability in gene regulatory domain size by measuring the total fraction of the genome annotated for any given ontology term and counting how many input genomic regions fall into those areas ( Fig. 1b and Online Methods). In the example above, GREAT expects 33% of all input elements to be associated with ‘multicellular organismal development’ by chance, rather than the 14% of input elements that a gene-based test assumes. The binomial test integrates distal binding events in a way that remains robust regardless of erroneous assignments of genomic regions to genes. Namely, the longer the regulatory domain of any gene—and, by extension, of any ontology term—the greater the expected number of regions associated with this term by chance. Indeed, the binomial statistic markedly reduces the number of false positive enriched terms even when very large regulatory domains are used ( Fig. 2b and Supplementary Fig. 1 ). The binomial test treats each input genomic region as a point-binding event, making it most suitable for testing targets with localized binding peaks. The binomial test also highlights cases in which a single gene attracts an unlikely number of input genomic regions. To separate these biologically interesting gene-specific events from term-derived enrichments that are distributed across multiple genes, we perform both the binomial test and the traditional hypergeometric gene-based test. In doing so, we highlight ontology terms enriched by both tests (term-derived enrichment) separately from those enriched by only the binomial test (gene-specific enrichment) or the hypergeometric test (regulatory domain bias) ( Fig. 2c and Supplementary Fig. 3 ).

GREAT supports direct enrichment analysis of both the human and mouse genomes. It integrates 20 separate ontologies containing biological knowledge about gene functions, phenotype and disease associations, regulatory and metabolic pathways, gene expression data, presence of regulatory motifs to capture cofactor dependencies, and gene families ( Supplementary Tables 1–3 and Online Methods). Core computations are performed by the GREAT server while subsequent browsing is executed on the user’s machine. An overview of the tool’s functionality and options when analyzing data is given in Table 1 , and its current web interface is shown in Supplementary Figure 4 .

To demonstrate the utility of our approach, we compared GREAT results to previously published gene-based analyses as well as to enrichments from the Database for Annotation, Visualization, and Integrated Discovery (DAVID) 21 . Most gene-based tools assess enrichments in a very similar manner; we chose DAVID as a representative gene-based tool owing to its popularity and its ability to test a breadth of data sources similar to that of GREAT ( Supplementary Table 4 ).

We analyzed eight ChIP-seq data sets from a range of human and mouse cells and tissues ( Supplementary Table 5 ), each with a different distribution of proximal and distal binding events ( Fig. 2a ). We tested each data set in six different ways: (i) by reproducing the original study’s list of enrichments, or if the original study did not report enrichments, by using DAVID on the set of genes with binding events within 2 kb of the transcription start site; (ii) by using GREAT with the default regulatory domain definition (basal promoter 5+1 kb and extension up to 1 Mb); (iii) by using GREAT’s hypergeometric test on the set of genes with binding events within 2 kb of the transcription start site, to control for the different gene mappings and ontologies in DAVID and GREAT; (iv) by using GREAT with a 5+1 kb basal promoter and a more limited 50 kb extension; and (v, vi) by using GREAT with either one (v) or two (vi) nearest genes up to 1 Mb ( Tables 2 and 3 , and Supplementary Tables 6–44 , indexed in Supplementary Table 45 ).

GREAT invariably revealed strong enrichments for experimentally validated functions of the specific factors, as well as for testable—and, to our knowledge, novel—functions. It also implicated subsets of regulatory regions in driving the assayed developmental processes and in activating key signaling pathways. In a majority of data sets, distal binding events were essential to recover known functions, strongly suggesting that many of the distal associations are biologically meaningful (see below). Furthermore, in most sets, restricting regulatory domain extension to 50 kb retains many enriched terms but omits roughly half of both the binding events and the genes implicated using the full 1-Mb extension. Although including distal associations is crucial, the exact distal association rule is not—the default rule, the nearest-gene rule, and the two-nearest-genes rule (tests ii, v and vi, respectively) behaved very similarly. Additionally, inclusion of the small set of experimentally determined gene regulatory domains we curated from the literature made very little difference in the rankings of any of the sets (data not shown). We present the analysis of four ChIP-seq data sets below and discuss the remainder in the Supplementary Note .

First, we analyzed a set of genomic regions bound by the serum response factor (SRF) in the human Jurkat cell line, identified via ChIP-seq and mapped to the genome using the quantitative enrichment of sequence tags (QuEST) ChIP-seq peak-calling tool 8 . This data set’s authors applied existing gene-based enrichment tools, which did not discern specific functions of SRF from the set of regions it binds 8 , and concluded that SRF is a regulator of basic cellular processes with no specific physiological roles (results reproduced in Table 2 ). Although SRF is indeed a regulator of basic cellular functions, numerous studies have implicated SRF in more specific biological contexts. SRF is a key regulator of the Fos oncogene 22 and has also been described as a “master regulator of actin cytoskeleton” 23 . Neither FOS nor actin appeared in the top ten hypotheses generated by the previous study ( Table 2 ). The same was true when we used GREAT with only proximal (2 kb) associations ( Supplementary Table 6 ).

However, GREAT analysis of the most significant SRF ChIP-seq peaks 8 (QuEST score > 1; n = 556) using the default settings (5+1 kb basal, up to 1 Mb extension) prominently highlights the key observation that gene-based analyses were unable to reveal: SRF regulates genes associated with the actin cytoskeleton 23 ( Table 3 ). As postulated above, using both binomial and hypergeometric enrichment tests does highlight informative GO terms more effectively than using either test alone ( Fig. 2c and Supplementary Table 46 ). Moreover, when extension of regulatory domains is limited to 50 kb, one-third of the supporting regions and associated genes are lost, and actin-related terms drop in rank ( Supplementary Table 7 ).

Coupling distal (up to 1 Mb) associations with the many additional ontologies available within GREAT provides a wealth of enrichments for specific known functions of SRF. An enrichment analysis of TreeFam gene families 24 shows that SRF binds in proximity to five of six members of the FOS family. Two genes within the Fos family, Fos and Fosb , are previously known targets of SRF (ref. 22 ). The Transcription Factor Targets ontology 25 has compiled data from ChIP experiments that link transcription factor regulators to downstream target genes. GREAT shows that many genes proximal to SRF binding events (in Jurkat cells) are also proximal to YY1 binding events (in HeLa cells), consistent with experiments showing that SRF acts in conjunction with YY1 to regulate Fos (ref. 26 ). The top six hits in the Predicted Promoter Motifs ontology 27 are all variants of the SRF motif generated from different experiments and thus serve as strong positive controls of our method. Using the Pathway Commons ontology 28 , GREAT predicts that SRF regulates components of the TRAIL signaling pathway and the class I PI3K signaling pathway. Previous experimental work has demonstrated that there is an association between SRF and TRAIL signaling 29 and that SRF is needed for PI3K-dependent cell proliferation 30 .

In addition to rediscovering and expanding specific known functions of SRF, GREAT produces testable hypotheses even for this well-studied transcription factor. The Transcription Factor Targets ontology indicates that SRF binds near genes regulated by E2F4 (in T98G, U2OS and WI-38 cells; Table 3 ). SRF and E2F4 have not been shown to co-regulate target genes; however, both SRF and E2F4 are known to interact with Smad3 (refs. 31 , 32 ), and they may thus be co-regulators of a common set of genes. The Predicted Promoter Motifs ontology reveals additional potential cofactors and co-regulators. It is particularly useful given that many more genes have characterized binding motifs than have genome-wide ChIP data available. In this case, it shows enrichment for SRF binding near genes containing GABP motifs in their promoters. Notably, an independent experiment measuring GABP-bound regions of the genome in Jurkat cells has found that 29% of SRF peaks occur within 100 bp of a GABP peak, suggesting that SRF and GABP may indeed work together 8 . We were able to generate this same hypothesis using GREAT, without observing the GABP ChIP-seq data.

Second, we analyzed a recent ChIP-seq data set comprising 2,105 regions of the mouse genome bound by the general enhancer-associated protein p300 in embryonic limb tissue 33 . Of 25 such regions tested in transgenic mouse assays, 20 showed reproducible enhancer activity in the developing limbs 33 . Our analysis shows that GREAT identifies functions of enhancers active during embryonic development that gene-based tools do not detect. DAVID analysis of the genes with proximal p300 limb binding events produces only enrichments associated with transcription and involvement in organ morphogenesis, with the closest enrichments being the much broader terms ‘organ development’ and ‘anatomical structure morphogenesis’ ( Supplementary Table 10a ). In contrast, GREAT analysis of the 2,105 p300 limb peaks using the default settings (5+1 kb basal, up to 1 Mb extension) produces overwhelming support for their putative functional role in limb development ( Supplementary Table 10b ).

GO enrichments highlight the regulation of transcription factors involved specifically in embryonic limb morphogenesis. The Mouse Phenotype ontology 34 points to the developing limbs and skull, hinting at the remarkable overlap of signaling processes involved in head and limb development 35 . The p300 limb peaks are enriched near genes in the TGF-β signaling pathway, which is known to be involved in limb development 36 , and the InterPro ontology highlights genes in the Smad family containing the Dwarfin-type MAD homology-1 protein domain ( Supplementary Table 10b ), which is known to mediate and regulate TGF-β signaling 37 .

Perhaps the strongest validation for the GREAT methodology comes from the MGI Expression: Detected ontology 38 . Notably, the enrichments highlighted most prominently by GREAT pinpoint the exact tissue and time point at which the experiment in ref. 33 was performed, providing unique large-scale evidence for the relevance of p300-bound regions to limb gene regulation. The top two ontology terms suggest limb-specific expression during Theiler stage 19 (TS19), which corresponds precisely with embryonic day 11.5, the time point at which the p300 limb peaks were assayed in ref. 33 ( Supplementary Table 10b ). In contrast, GREAT run with proximal (2 kb) associations retrieves only weak enrichments for limb-associated genes and limb TS19, implicating 7-fold fewer genes and 16-fold fewer p300 limb peaks as being involved in TS19 limb expression than GREAT run with the default association rule ( Supplementary Table 11 ). Moreover, GREAT run with proximal associations completely misses genes with crucial roles in limb development such as Gli3 , Grem1 and Wnt7a (ref. 39 ).

When GREAT’s regulatory domains are extended up to 50 kb, it correctly recovers limb terms, but still implicates only half the genes found with the default association rule and yields P values many orders of magnitude weaker ( Fig. 3 and Supplementary Table 12 ). By extending regulatory domains, we increase both the number of limb-related genes containing one or more p300 limb peaks within their regulatory domains and the number of p300 limb peaks associated with limb-related genes ( Fig. 3 ). When regulatory domains are further extended from 50 kb to 1 Mb, they include even more p300 limb peaks than expected by chance ( Fig. 3c ), providing strong evidence that many of these distal associations are biologically meaningful.

Finally, we analyzed two ChIP-seq data sets comprising regions bound by p300 in mouse embryonic forebrain and midbrain tissue 33 . Using the 2,453 forebrain peaks, DAVID correctly highlights forebrain and general brain development (0.004 < P < 0.05), but with terms implicating fewer than ten genes ( Supplementary Table 15a ). GREAT run with proximal regulatory regions (2 kb) ranks forebrain development higher and is able to implicate additional genes and regions using its unique phenotype and expression ontologies ( Supplementary Table 16 ). Using up to 50 kb extension adds additional related terms and raises the number of genes associated with each term ( Supplementary Table 17 ). This trend continues when the extension is increased to up to 1 Mb, and only this inclusion of distal binding allows detection of significant associations ( P = 0.001) with Wnt signaling genes that have known roles in forebrain development 40 ( Supplementary Table 15b ).

When run on the 561 midbrain p300 peaks, DAVID does not yield significant results (P > 0.05; Supplementary Table 20a ) and proximal (2 kb) GREAT performs only slightly better, offering three relevant terms associated with very few genes from our unique ontologies ( Supplementary Table 21 ). In contrast, GREAT with up to 1 Mb extension highlights twelve brain-specific enriched terms ( Supplementary Table 20b ). Many GREAT enriched terms are shared between the forebrain and midbrain peaks (as discussed in Supplementary Note ), but GREAT correctly identifies midbrain-specific enrichments such as the GO term ‘compartment specification’. Compartment specification is of interest, as within this tissue at this developmental age, Fgf8 induces Wnt (also enriched within this set) to set up a gene network that establishes the boundary between the midbrain and hindbrain compartments 41 . GREAT with up to 50 kb extension is able to highlight many of the same terms, but loses roughly half the associated genes and regions and the Wnt enrichment ( Supplementary Table 22 ).

## DISCUSSION
GREAT is a new-generation tool aimed at the interpretation of genome-wide cis -regulatory data sets. It explicitly models the vertebrate cis -regulatory landscape through the use of long-range regulatory domains and a genomic region–based enrichment test, allowing analyses that take into consideration the large number of binding events that occur far beyond proximal promoters. By accounting for the length of gene regulatory domains, GREAT is able to highlight biologically meaningful terms and their associated cis -regulatory regions and genes, in a manner that remains robust if there are false associations between input regions and genes. Moreover, these regulatory-domain definitions can naturally incorporate future results from three-dimensional conformation capture studies 17 – 19 , radiation hybrid maps 42 and other emerging approaches for measuring the regulatory genome in action. By coupling this methodology with many ontologies that span a wealth of biological information types, GREAT produces specific, accurate enrichments that provide insight into the biological roles of cis -regulatory data sets of interest.

We comprehensively tested GREAT on multiple ChIP-seq data sets and found that it is able to reproduce many known biological facts that existing methods do not detect, as well as suggest novel hypotheses for further experimental characterization. In particular, our analysis shows that ignoring distal binding events often leads to missing target gene associations, to obtaining weaker P values or even to completely omitting relevant enrichment terms. Besides ChIP-seq data, GREAT can also be applied to the analysis of any data set thought to be enriched for localized cis -regulatory regions. This includes functional genomic data sets of open chromatin, localized epigenomic markers, and comparative genomic sets. GREAT may thus prove invaluable in elucidating the cis -regulatory functions encoded in genomes.

GREAT is available online ( http://great.stanford.edu/ ); also provided is a means for direct submission from other applications such as genome portals and peak calling tools.

## ONLINE METHODS
Statistical enrichment of ontology terms is dependent upon the genome-wide gene set used in the analysis. GREAT currently supports testing of human ( Homo sapiens NCBI Build 36.1, or UCSC hg18) and mouse ( Mus musculus NCBI Build 37, or UCSC mm9). To limit the gene sets to only high-confidence genes and gene predictions, we use only the subset of the UCSC Known Genes 45 that are protein coding, are on assembled chromosomes and possess at least one meaningful GO annotation 14 . GO is an ontological representation of information related to the biological processes, cellular components and molecular functions of genes. We rely on the idea that if a gene has been annotated for function it should be included in the gene set, and if no function has been ascribed to a gene its status may be unclear and thus it is best omitted from the gene set. In GREAT version 1.1.3, we use GO data downloaded on 5 March 2009 for human and 23 March 2009 for mouse, leading to gene sets of 17,217 and 17,506 genes for human and mouse, respectively.

A single gene may have multiple splice variants. As annotations are generally given at the gene level, GREAT uses a single transcription start site (TSS) to specify the location of each gene. The TSS used is that of the ‘canonical isoform’ of the gene as defined by the UCSC Known Genes track 45 .

For each gene, we define a ‘regulatory domain’ such that all noncoding sequences that lie within the regulatory domain are assumed to regulate that gene. GREAT currently supports three different parametrized association rules to define gene regulatory domains ( Supplementary Fig. 2 ). The default ‘basal plus extension’ association rule assigns a ‘basal regulatory region’ irrespective of the presence of neighboring genes that extends (using default parameters) 5 kb upstream and 1 kb downstream of the TSS ( Supplementary Fig. 2a ). Each gene’s regulatory domain is then extended up to the basal regulatory region of the nearest upstream and downstream genes, but no longer than 1 Mb in each direction. The choice of basal regulatory region size and placement was motivated by the location of histone modifications and measures of chromatin accessibility near the TSS of genes 46 , and the maximum extension distance is based upon work showing that long-range distal enhancers can regulate expression of target genes up to 1 Mb away 47 , 48 . All three parameters (basal upstream, basal downstream and maximum extension distance) can be set by the user.

The ‘two nearest genes’ association rule extends each gene’s regulatory domain from the TSS of the canonical isoform to the nearest upstream and downstream TSS ( Supplementary Fig. 2b ), up to 1 Mb in each direction. This association rule stipulates that each base pair cannot be assigned to more than two genes.

The ‘single nearest gene’ association rule extends each gene’s regulatory domain from the TSS of the canonical isoform in each direction to the midpoint between the TSS and the nearest adjacent TSS ( Supplementary Fig. 2c ), up to 1 Mb in each direction. This association rule stipulates that each base pair cannot be assigned to more than one gene.

For well-studied genes with experimentally detected distal regulatory elements (reviewed in ref. 20 ), we manually override the computationally defined regulatory domains. GREAT version 1.1.3 uses experimentally validated regulatory domains for SHH 47, genes in the β-globin locus49, and KIAA1715 , EVX2 , HOXD10 , HOXD11 , HOXD12 and HOXD13 (ref. 50 ). Future releases of the tool will continue to refine regulatory domains as technological advances, including three-dimensional conformation capture studies 17 – 19 and radiation hybrid maps 42 , further elucidate interactions between regulatory DNA and its target genes.

The hypergeometric test over genes identifies all genes whose regulatory domains possess one or more genomic regions from the input set and calculates enrichments over the genes with respect to the defined gene set using a hypergeometric distribution. More formally, the hypergeometric test is executed separately for each ontology term π and is defined by four parameters: N is the total number of genes in the genome. K π is the number of genes in the genome that possess ontology annotation π. n is the number of genes selected because one or more input genomic regions resides in their regulatory domains. k π is the number of selected genes that possess ontology annotation π. The test calculates the P value of the observed enrichment for term π as the fraction of ways to choose n genes without replacement from the entire group of N genes such that at least k π of the n possess ontology annotation π, using the formula below. (1) ∑ i = k π min ( n , K π ) ( K π i ) ( N − K π n − i ) ( N n ) In particular, the hypergeometric test counts every gene only once even if it was picked by multiple genomic regions. Terms enriched by the hypergeometric test thus indicate a high ‘term coverage’, where a larger fraction of all genes annotated with the term are selected by the input genomic regions than expected by chance.

N is the total number of genes in the genome.

K π is the number of genes in the genome that possess ontology annotation π.

n is the number of genes selected because one or more input genomic regions resides in their regulatory domains.

k π is the number of selected genes that possess ontology annotation π.

To account for the length variability within gene regulatory domains, we implemented a binomial test over genomic regions that uses the fraction of the genome associated with each ontology term as the probability of selecting the term. The binomial test is executed separately for each ontology term π and is defined by three parameters: n is the total number of genomic regions in the input set. p π is the a priori probability of selecting a base pair annotated with π when selecting a single base pair uniformly from all non–assembly gap base pairs in the genome. k π is the number of genomic regions in the input set that cause annotation π to be selected. The test calculates the P value of the observed enrichment for term π as the probability of selecting annotation π at least k π times in n attempts using the formula below. (2) ∑ i = k π n ( n i ) p π i ( 1 − p π ) n − i

n is the total number of genomic regions in the input set.

p π is the a priori probability of selecting a base pair annotated with π when selecting a single base pair uniformly from all non–assembly gap base pairs in the genome.

k π is the number of genomic regions in the input set that cause annotation π to be selected.

The binomial test first maps each input genomic region to the left median base pair in its span, making it most appropriate for assessing enrichment of factors with narrow, precise peaks. The value of p π is calculated for each ontology annotation π as the fraction of non–assembly gap base pairs in the genome associated with annotation π. Each input genomic region can then be thought of as a ‘dart’ thrown at the genome, counting as a hit if the left median base pair is annotated with ontology term π. In this test, the length of each gene’s regulatory domain is explicitly accounted for in the calculation of p π . This explicit use of regulatory domain size in the significance calculation provides a proper assessment of the enrichment for ontology terms by noncoding sequences. Notably, as the binomial test incorporates the fraction of the genome assigned to each gene in the calculation of statistical significance, it is robust regardless of variation in association rules and occasional incorrect assignments of genomic regions to distal target genes. Ontology terms assigned to genes that have large regulatory domains are inherently weighted such that each binding event associated with the term contributes less to the resulting enrichment than binding events associated with terms assigned to genes with small regulatory domains. However, enrichments under the binomial test may arise from clusters of noncoding regions all near one or a few genes with a particular ontology annotation, as well as from noncoding regions associating with many genes that possess a particular ontology annotation. The hypergeometric test over genes (described above) provides a measure of ‘term coverage’ that can be used to identify terms significant by the binomial test that have many annotated genes selected as well.

When a set of input genomic regions is selected from a superset of ‘background genomic regions’ (for example, the repetitive elements that have been exapted into functional roles selected from all repetitive elements in the genome 12 ), one should consider whether the input genomic regions differ in functional composition from the entire set of background genomic regions as a whole. The foreground/background hypergeometric test over genomic regions poses this statistical question by mapping all ontology annotations of each gene to all background genomic regions that lie within its regulatory domain; it then calculates enrichments over the input genomic regions with respect to the superset of background genomic regions using a hypergeometric distribution. Formally, the foreground/background hypergeometric test over genomic regions is executed separately for each ontology term π and is defined by four parameters: N is the number of genomic regions in the background set. K π is the number of genomic regions in the background set that lie within the regulatory domain of some gene annotated with term π. n is the number of genomic regions in the foreground set. k π is the number of genomic regions in the foreground set that lie within the regulatory domain of some gene annotated with term π.

N is the number of genomic regions in the background set.

K π is the number of genomic regions in the background set that lie within the regulatory domain of some gene annotated with term π.

n is the number of genomic regions in the foreground set.

k π is the number of genomic regions in the foreground set that lie within the regulatory domain of some gene annotated with term π.

The test calculates the P value of the observed enrichment for term π using the hypergeometric equation shown above, equation (1) .

The GREAT core calculation engine is implemented in C and the source code is publicly available for download ( http://great.stanford.edu/ ).