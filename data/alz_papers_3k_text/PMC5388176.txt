# Title
A reference panel of 64,976 haplotypes for genotype imputation

# Abstract
We describe a reference panel of 64,976 human haplotypes at 39,235,157 SNPs constructed using whole genome sequence data from 20 studies of predominantly European ancestry. Using this resource leads to accurate genotype imputation at minor allele frequencies as low as 0.1%, a large increase in the number of SNPs tested in association studies and can help to discover and refine causal loci. We describe remote server resources that allow researchers to carry out imputation and phasing consistently and efficiently.

## Online methods
Every study provided us with their most recent version of their haplotypes in VCF format with one VCF for every autosome. For every cohort, bcftools (v0.2.0-rc12) was used to create an entire-autosome, SNP-only site list with alternate and total allele count information from these per-chromosome haplotypes. Multiallelic SNPs were broken into biallelics using ‘bcftools norm’. These per-cohort site lists were merged into a single file using an in-house Perl script that correctly merges alternate and total allele counts. We created site lists called MAC2 and MAC5 containing only sites with a minor allele count (MAC) across all studies of >= 2 and >=5, respectively, using bcftools. These sites lists contained 95,855,206 and 51,060,347 sites, respectively.

The 'samtools mpileup' command was used to generate genotype likelihoods (GLs) at all MAC2 sites on a per sample basis from each sample’s BAM file. The pipeline and software versions have been made available online (see URLs ). The resulting BCF files were merged using the 'bcftools merge' command and the MAC2 sites and alleles extracted using the 'bcftools call' command. The use of 'bcftools call' here made a baseline set of non-LD based genotype calls for each site across all samples. These calls were used for some initial sample QC (see Sample filtering section). We calculated GLs on 33,070 samples in total.

We used an ad-hoc method for initial variant filtering which enabled us to identify variants that had been filtered out ‘quite often’ by our submitting studies. For each site and for each cohort, we labelled the site as “called” in that study if the putative calls from bcftools based on GLs exhibited more than one allele in that cohort, or “not called” if it showed no variation. We also used the haplotype sets provided by each study to determine whether each study had filtered out each site or not using their own internal calling pipeline. To determine a threshold of “number of times filtered out”, we stratified the sites according to their called status versus their filtered status ( Supplementary Figure 5 ). We also measured the Ts/Tv ratio of the set of SNPs for each of these stratified combinations. SNPs corresponding to the cells above the red line in the figure were filtered out, removing all cells which had been filtered out by more than 4 studies or have Ts/Tv ratio less than 1.7.

We also applied a set of additional site filters as follows. We filtered out sites not on the MAC5 site list to restrict the site list to those that could be imputed well. We also filtered out sites if (i) any study (apart from 1000 Genomes) had a Hardy-Weinberg Equilibrium (HWE) p-value < 10 -10 , (ii) any study (apart from 1000 Genomes) had an overall inbreeding coefficient < -0.1, (iii) a MAF>0.1 with the site being called in fewer than 3 of the studies and not called in 1000 Genomes (the latter restriction kept sites present at high frequencies in non-European populations that were only called in 1000 Genomes). We also filtered out sites called only in the GoNLstudy or IBD cohort. We completely excluded GPC haplotypes from this step of the site list creation process.

After applying these filters, the site list comprised of 44,038,997 sites. Finally, we made sure that 4,914,335 sites found on a selection of common SNP genotyping arrays and those used in the GIANT consortium and the Global Lipids Consortium ( Supplementary Table 7 ) were included in the final site list. The final site list after this filtering contained 44,187,567 sites.

Having used 'bcftools call' to extract sites and alleles, we had a set of baseline non-LD genotype calls (see Genotype likelihood calculations section). Based on these calls for chromosome 22, some outlier samples were evident and we removed 150 samples showing evidence for fewer than 10,000 non-reference SNPs or more than 10 singletons across the chromosome. This left a total of 32,920 samples.

To detect possible duplicates we used the original genotype calls submitted by the individual studies. We selected 1000 random sites that (1) were biallelic; (2) had European minor allele frequency > 5% in 1000GP3; and (3) had no missing data in any of the individual studies. Using the 'bcftools gtcheck' command, we counted the number of genotypes that differed between each sample pair. There was a clear set of 269 sample pairs with very few genotypes differing over the 1000 sites. We identified these samples as duplicates either within or between studies and removed one of the samples in the pair as described in Supplementary Table 8 . Due to some samples being represented more than twice, there were a total of 261 samples removed due to duplicates. Before genotype calling, we also removed (i) 9 samples for which we had Complete Genomics data so that we could use these samples for testing purposes, (ii) 31 samples from 1000GP3 that were related samples (see URLs ), (iii) 8 samples from the HELIC, AMD and ProjectMinE studies with sample labeling inconsistencies. These filters resulted in 32,611 samples being used for the genotype calling and phasing steps.

In addition, after the phasing, 83 samples from the AMD study were removed as the consent for these samples had been removed. We also repeated the duplicate detection process on the final HRC genotype calls, since some studies increased in size late on within the analysis process. This resulted in an extra 40 samples being removed and a total of 32,488 samples in the final phased reference panel.

We called genotypes from the genotype likelihoods computed on the HRC samples by extending the SNPTools 22 algorithm to leverage pre-existing haplotypes available from each cohort. Like other phasing and calling approaches 8 , 10 , SNPTools is an MCMC approach in which each sample's haplotypes and genotypes are iteratively updated using the current estimates of all other samples. A low-complexity Hidden Markov Model (HMM) with just four states is used to update each sample, where the states are a set of four "surrogate parent" haplotypes. The MCMC sampler employs a Metropolis-Hastings (MH) step to sample the set of surrogate parents. In large sample sizes the search space for these surrogate haplotypes is huge and results in low acceptance rates for the sampler. Our extension, called GLPhase (see URLs ) uses pre-existing haplotypes to restrict the set of possible haplotypes from which the MH sampler may choose surrogate parent haplotypes. For each individual, we restrict the search space to 200 haplotypes that most closely match the two pre-existing haplotypes of the individual using a Hamming distance metric (100 for each haplotype). We run the method on chunks of 1,024 sites at a time, which is the default setting for SNPtools. Since the pre-existing haplotypes from each study do not contain exactly the same set of sites we filled in missing alleles in the pre-existing haplotypes at our site list using the major allele at each site.

Restricting the search space in this way allows us to reduce the number of burn-in iterations from 56 to 5, the number of sampling iterations from 200 to 95, and the number of MH steps taken at each iteration for each individual from 2 N to 100, where N is the number of samples being phased. This reduces the complexity of our phasing algorithm from O(N 2 ) to O(N). Although our implementation of the Hamming distance search has complexity O(N 2 ), for N = 30,000, the impact of the search on run time is small (~5% of run time on each chunk). A chunk of 1024 sites can be phased in ~200 minutes using ~1.3GB of RAM. Once sample sizes are encountered where the Hamming distance search begins to dominate, our implementation could be replaced with O(N log N) clustering algorithms that we have implemented within the SHAPEIT3 algorithm 12 .

To illustrate how important GLPhase was to genotype calling and phasing on such a large sample size, we carried out a comparison to Beagle 3.1, Beagle 4.1 and the original SNPTools method. We ran all four methods on five randomly selected 1024 site chunks from chromosome 20 on the cluster using increasing sample sizes and measured run time. Supplementary Figure 6 shows that GLPhase is approximately 100 times faster than the next quickest method at the full HRC sample size.

We estimated haplotypes from GLPhase genotype calls using SHAPEIT3 12 . Chromosomes were phased in chunks consisting of 16,000 variants plus 3,300 variants overlapping with neighboring chunks on either side. The non-default command line option -w 0.5 was used for SHAPEIT3. Chunks were ligated using the ligateHAPLOTYPES program (see URLs ). SHAPEIT3 does not handle multiple variants at the same genomic coordinate, so multiallelic sites (SNPs with 3 or 4 alleles) were shifted by one or two base pairs for rephasing, and then moved back to their original position after chunk ligation.

We tested the genotype calling process on data from chromosome 20 with different combinations of site lists and sample sets to assess both the effects of site filtering and the benefits of increasing samples size. We evaluated 3 different site lists: the 1000 Genomes Phase 3 set of sites (775,927), our HRC MAC5 site list (1,128,114) and our HRC MAC5 site list with additional site filtering (1,006,559). We ran the genotype calling method on 3 different sets of samples : the 2,525 original 1000 Genomes Phase 3 samples, a subset of 13,309 HRC samples that we used at an early stage of HRC testing (HRC Pilot) from studies 1000GP3, AMD, GoNL, GoT2D, ORCADES, SardinIA, FINLAND and UK10K, and the near-final full set of 32,905 HRC samples. We called genotypes using GLPhase on each of these 9 datasets and examined genotype discordance compared to Illumina OMNI2.5M genotypes produced by the 1000 Genomes Project. For this comparison, we focused only on genotypes from 365 samples shared across the 3 sample sets and at 42,244 SNP sites. We calculated percentage discordance for the 3 possible genotypes consisting of reference (REF) and alternate (ALT) alleles as well as an overall non-reference allele discordance rate (NRD). Results are shown in Supplementary Table 2 .

We assessed imputation accuracy of 4 different reference panels : 1000 Genomes Phase 3, UK10K, and two versions of the HRC reference panel, with and without re-phasing with SHAPEIT3. To do this we used high-coverage WGS data made publicly available by Complete Genomics (CG) (see URLs ). For the pseudo-GWAS samples we used data from 10 CEU samples that also occur in the 1000 Genomes Phase 3 samples. These samples were removed from the various reference panels before using them to assess imputation performance.

Three pseudo-GWAS panels were created based on three chip lists (see URLs ) : The Illumina Omni 5M SNP array (HumanOmni5-4v1-1_A), the Illumina Omni 1M SNP array (Human1M-Duo v3C), and the Illumina Core Exome SNP array (humancoreexome-12v1-1_a). For these comparisons we only used sites in the intersection of the reference panels to enable a direct comparison.

These pseudo-chip genotypes were used to impute the remaining genotypes which were then compared to the held out genotypes, stratifying results by MAF of the imputed sites.

Imputation was carried out using IMPUTE2 7 which chooses a custom reference panel for each study individual in each 2 Mb segment of the genome. We set the khap parameter of IMPUTE2 to 1000. All other parameters were set to default values. We stratified imputed variants into allele frequency bins and calculated the squared correlation between the imputed allele dosages at variants in each bin with the masked CG genotypes (called aggregate r 2 in Figure 1 ). Non-reference allele frequency for each SNP was calculated from HRC release 1 GLs at MAC>=5 sites. Figure 1 shows the results for the Illumina Omni 1M chip. Supplementary Figures 3 and 4 show the results from the Illumina Core Exome chip and the Illumina Omni 5M chip respectively.

A total of 1,210 individuals from the InCHIANTI study were genotyped using the Illumina Infinium HumanHap550 genotyping array 13 , 14 . Individuals were pre-phased using autosomal SNPs after filtering out SNPs with MAF <1%, Hardy-Weinberg p -value <10 -04 , and missingness >1%. SNPs were also removed if they could not be remapped to the GRCh37 (hg19) human reference. This resulted in 483,991 SNPs available for pre-phasing. Phasing was performed locally using SHAPEIT2 10 .

Imputation was performed remotely using the Michigan Imputation Server (see URLs ). A total of 39,235,157 SNPs and 47,045,346 variants were imputed from the HRC and 1000 Genomes Phase 3 (v5) reference panels, respectively. An imputation quality threshold of r 2 >0.5 was subsequently applied to both imputation datasets prior to association testing. This resulted in 15,501,516 and 13,589,949 variants available for association analysis derived from HRC- and 1000 Genomes-based imputation, respectively.

A total of 93 circulating factors available in the InCHIANTI study were double inverse-normalised, while adjusted for age and sex, prior to association testing 14 , 15 . Association analysis was performed using a linear mixed model framework as implemented in GEMMA (see URLs ). Plots of association in Figure 2 were produced using LocusZoom (see URLs ).

We attempted to replicate the associations reported in Supplementary Table 3 in the SHIP and SHIP-TREND cohorts 23 . The SHIP samples were genotyped using the Affymetrix Genome-Wide Human SNP Array 6.0. The SHIP-TREND samples was genotyped using the Illumina Human Omni 2.5 array. Prior to imputation, duplicate samples (by IBS), samples with reported vs. genotyped gender mismatch or samples with a very high heterozygosity rate were excluded. Additionally, all monomorphic SNPs, SNPs with duplicate chromosomal position, SNPs with pHWE <0.0001 and SNPs with a callrate <95% were filtered. Imputation was performed on the Sanger Imputation Service (see URLs ) against the HRC panel. In total, 4,070 SHIP samples and 986 SHIP-TREND samples were included in the imputation of genotypes. Association analyses were conducted using SNPTEST v2.5.2 24 .